-- Blox Fruits Auto Farm Script (Fly and Quest Complete)

-- Setup references
local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
local humanoid = character:WaitForChild("Humanoid")
local mouse = player:GetMouse()

-- Settings
local flyingHeight = 100  -- Height to fly above NPCs
local attackRange = 20    -- Attack range to hit NPCs
local attackDelay = 0.5   -- Delay between attacks (adjust for combat speed)
local questTargetName = "Bandit"  -- NPC name to target
local questGiverName = "QuestGiver"  -- Quest NPC name (change as needed)
local isAutoFarming = false

-- Find and interact with the quest giver
local function takeQuest()
    local questGiver = game.Workspace:FindFirstChild(questGiverName)
    if questGiver then
        local questNpc = questGiver:FindFirstChild("HumanoidRootPart")
        if questNpc then
            -- Move towards the quest giver (you can simulate clicking the NPC to take the quest)
            humanoidRootPart.CFrame = CFrame.new(questNpc.Position + Vector3.new(0, 5, 0)) -- Move close to quest giver
            wait(0.5) -- Wait for interaction
            -- Simulate quest accepting (you would typically press a button to accept the quest in game)
            print("Quest accepted!")
        end
    end
end

-- Function to enable flying above NPCs
local function enableFlying()
    humanoidRootPart.CFrame = humanoidRootPart.CFrame + Vector3.new(0, flyingHeight, 0)
    print("Flying enabled.")
end

-- Function to enlarge the hitbox (enables auto-hitting NPCs while flying)
local function enlargeHitbox()
    humanoid.HipWidth = 10  -- Increase hip width for larger hitbox
    humanoid.HipHeight = 10  -- Increase hip height for larger hitbox
    humanoidRootPart.Size = Vector3.new(10, 10, 10)  -- Increase humanoid root size
end

-- Function to automatically attack NPCs in range
local function autoAttack()
    while isAutoFarming do
        local closestEnemy = nil
        local minDist = math.huge

        -- Find the closest NPC in range
        for _, enemy in pairs(game.Workspace:GetChildren()) do
            if enemy:IsA("Model") and enemy:FindFirstChild("HumanoidRootPart") then
                if enemy.Name == questTargetName then
                    local dist = (humanoidRootPart.Position - enemy.HumanoidRootPart.Position).Magnitude
                    if dist < minDist and dist <= attackRange then
                        minDist = dist
                        closestEnemy = enemy
                    end
                end
            end
        end

        -- Attack the closest NPC
        if closestEnemy then
            humanoidRootPart.CFrame = CFrame.new(closestEnemy.HumanoidRootPart.Position)
            -- Simulate attack (can be replaced with actual attack logic)
            print("Attacking " .. closestEnemy.Name)
            -- Place your attack function or logic here (e.g., using abilities, pressing M1, etc.)
        end

        wait(attackDelay)  -- Adjust attack delay as needed
    end
end

-- Function to start the autofarm (toggle state)
local function startAutoFarm()
    isAutoFarming = true
    takeQuest()  -- Take quest before starting
    enableFlying()  -- Fly above NPCs
    enlargeHitbox()  -- Enlarge hitbox
    print("Auto Farming Started.")
    autoAttack()  -- Start attacking NPCs automatically
end

-- Function to stop the autofarm
local function stopAutoFarm()
    isAutoFarming = false
    humanoid.HipWidth = 2  -- Reset hitbox to default
    humanoid.HipHeight = 2
    humanoidRootPart.Size = Vector3.new(2, 2, 2)  -- Reset root size to normal
    print("Auto Farming Stopped.")
end

-- Hotkey to toggle auto-farming (example: press "F" to start/stop auto-farming)
mouse.KeyDown:Connect(function(key)
    if key:lower() == "f" then  -- Press "F" to toggle
        if isAutoFarming then
            stopAutoFarm()  -- Stop farming if it's already enabled
        else
            startAutoFarm()  -- Start farming if it's not enabled
        end
    end
end)
